steps:
- name: 'gcr.io/cloud-builders/mvn'
  args: ['install']
  env: ['DATABASE_NAME=recipease','JDBC_PASSWORD=abc','JDBC_SCHEMA=recipease','JDBC_URL=34.70.51.191','JDBC_USERNAME=abc']
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args: ['-c', 'docker build -t gcr.io/$PROJECT_ID/go-fund-you:testlatest -f ./devops/Dockerfile --build-arg JDBC_PASSWORD=$$JDBC_PASSWORD .']
  secretEnv: ['JDBC_PASSWORD']
 
#- name: "gcr.io/cloud-builders/gcloud"
 # args: ["app", "deploy"]
- name: 'gcr.io/cloud-builders/gke-deploy:stable'
  args:
  - 'run'
  - '--image=gcr.io/project2-251819/recipease'
  - '--location=us-central1-c'
  - '--cluster=hello-java-cluster'
  - '--expose=8080'
timeout: "1600s"
images: ['gcr.io/project2-251819/recipease']
options:
  env: ['DATABASE_NAME=recipease','JDBC_PASSWORD=abc','JDBC_SCHEMA=recipease','JDBC_URL=34.70.51.191','JDBC_USERNAME=abc']
secrets:
- kmsKeyName: 'projects/project-2-251819/locations/global/keyRings/gfy-keyring/cryptoKeys/gofundyoukey'
  secretEnv:
    JDBC_PASSWORD: 'CiQAXCcwx5ZC7/CE/Ba4uni1zTthMq27k+rsVxtMRaUAkNijECESIQAQAZBNhcm82l14tHkqG7/1oZQjt3p1RboY6Fo+JCr5pQ=='
